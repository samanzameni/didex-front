<div arrangeInline class="page-header">
  <h2>Funds</h2>

  <!--
  <ul arrangeInline class="page-header__items">
    <li class="page-header__item">
      <dropdown-select
        [caption]="'Sort by'"
        [items]="sortSelectOptions"
        (valueChange)="onSortValueChange($event)"
      ></dropdown-select>
    </li>
    <li class="page-header__item">
      <label class="form-control" for="search">
        <input type="text" name="search" id="search" placeholder=" " />
        <span class="actual-label">Search</span>
      </label>
    </li>
  </ul>
  -->
</div>

<section class="page-content">
  <mat-table [dataSource]="tableRows" multiTemplateDataRows>
    <ng-container
      *ngFor="let column of dataColumns"
      matColumnDef="{{ column }}"
    >
      <mat-header-cell *matHeaderCellDef>
        {{ mapColumnToHeader(column) }}
        <button
          *ngIf="!!mapColumnToTooltip(column)"
          mat-icon-button
          matTooltip="{{ mapColumnToTooltip(column) }}"
          class="header-tooltip-button"
        >
          <mat-icon>help</mat-icon>
        </button>
      </mat-header-cell>
      <mat-cell *matCellDef="let item" [title]="item[column]">
        {{ item[column] }}
      </mat-cell>
    </ng-container>

    <ng-container matColumnDef="actions">
      <mat-header-cell
        *matHeaderCellDef
        style="text-align: center; justify-content: center;"
      >
        Actions
      </mat-header-cell>
      <mat-cell *matCellDef="let item; let i = dataIndex">
        <div arrangeInline class="funds__actions">
          <button
            mat-icon-button
            disableRipple
            class="funds__action-button"
            [ngClass]="{ 'is-active': this.activePane === i + '-deposit' }"
            (click)="handleClickOnAction(i, 'deposit')"
            title="Deposit"
          >
            <svg
              id="deposit"
              xmlns="http://www.w3.org/2000/svg"
              width="15.812"
              height="14.437"
              viewBox="0 0 15.812 14.437"
            >
              <g id="Group_2622" data-name="Group 2622">
                <g
                  id="Group_2621"
                  data-name="Group 2621"
                  transform="translate(0 0)"
                >
                  <path
                    id="Path_6498"
                    data-name="Path 6498"
                    d="M14.781,28.537V26.9a1.549,1.549,0,0,0-1.547-1.547h-2L7.9,22.391a.516.516,0,0,0-.685,0L3.886,25.354H2.578A2.581,2.581,0,0,0,0,27.932V34.12A2.581,2.581,0,0,0,2.578,36.7H13.234a1.549,1.549,0,0,0,1.547-1.547V33.515a1.549,1.549,0,0,0,1.031-1.458V29.995A1.549,1.549,0,0,0,14.781,28.537Zm-7.218-5.07,2.124,1.888H5.438Zm6.187,11.685a.516.516,0,0,1-.516.516H2.578A1.549,1.549,0,0,1,1.031,34.12V27.932a1.549,1.549,0,0,1,1.547-1.547H13.234a.516.516,0,0,1,.516.516v1.547H12.2a2.578,2.578,0,0,0,0,5.156h1.547Zm1.031-3.094a.516.516,0,0,1-.516.516H12.2a1.547,1.547,0,0,1,0-3.094h2.062a.516.516,0,0,1,.516.516Z"
                    transform="translate(0 -22.261)"
                  />
                </g>
              </g>
              <g
                id="Group_2624"
                data-name="Group 2624"
                transform="translate(11.687 8.25)"
              >
                <g
                  id="Group_2623"
                  data-name="Group 2623"
                  transform="translate(0 0)"
                >
                  <circle
                    id="Ellipse_71"
                    data-name="Ellipse 71"
                    cx="0.516"
                    cy="0.516"
                    r="0.516"
                  />
                </g>
              </g>
            </svg>
          </button>
          <button
            mat-icon-button
            disableRipple
            class="funds__action-button"
            [ngClass]="{ 'is-active': this.activePane === i + '-withdraw' }"
            (click)="handleClickOnAction(i, 'withdraw')"
            title="Withdraw"
          >
            <svg
              id="withdraw"
              xmlns="http://www.w3.org/2000/svg"
              width="17.557"
              height="15.61"
              viewBox="0 0 17.557 15.61"
            >
              <path
                id="withdraw-2"
                data-name="withdraw"
                d="M15.858,27.5H1.7A1.7,1.7,0,0,0,0,29.2v8.5a1.7,1.7,0,0,0,1.7,1.7H6.8a.566.566,0,1,0,0-1.133H4.49A3.973,3.973,0,0,0,1.133,34.9V31.99A3.973,3.973,0,0,0,4.49,28.633h8.577a3.973,3.973,0,0,0,3.358,3.357V34.9a3.973,3.973,0,0,0-3.358,3.357H10.761a.566.566,0,1,0,0,1.133h5.1a1.7,1.7,0,0,0,1.7-1.7V29.2A1.7,1.7,0,0,0,15.858,27.5ZM3.341,38.261H1.7a.567.567,0,0,1-.566-.566V36.052A2.84,2.84,0,0,1,3.341,38.261Zm-2.208-7.42V29.2a.567.567,0,0,1,.566-.566H3.341A2.84,2.84,0,0,1,1.133,30.841Zm13.083-2.208h1.642a.567.567,0,0,1,.566.566v1.642A2.84,2.84,0,0,1,14.216,28.633Zm1.642,9.628H14.216a2.84,2.84,0,0,1,2.208-2.208v1.642A.567.567,0,0,1,15.858,38.261Zm-3.964-4.814a3.115,3.115,0,1,0-3.115,3.115A3.119,3.119,0,0,0,11.893,33.447Zm-5.1,0a1.982,1.982,0,1,1,1.982,1.982A1.984,1.984,0,0,1,6.8,33.447ZM4.248,32.88a.566.566,0,1,1,0,1.133H3.964a.566.566,0,1,1,0-1.133Zm9.062,1.133a.566.566,0,1,1,0-1.133h.283a.566.566,0,1,1,0,1.133Zm-2.962,6.962a.566.566,0,0,1,0,.8L9.179,42.944a.566.566,0,0,1-.8,0L7.21,41.776a.566.566,0,0,1,.8-.8l.2.2v-2.7a.566.566,0,1,1,1.133,0v2.7l.2-.2a.566.566,0,0,1,.8,0Z"
                transform="translate(0 -27.5)"
              />
            </svg>
          </button>
          <button
            mat-icon-button
            disableRipple
            class="funds__action-button"
            [ngClass]="{ 'is-active': this.activePane === i + '-transfer' }"
            class="funds__action-button"
            (click)="handleClickOnAction(i, 'transfer')"
            title="Transfer"
          >
            <svg
              id="currency-exchange"
              xmlns="http://www.w3.org/2000/svg"
              width="13.719"
              height="15.61"
              viewBox="0 0 13.719 15.61"
            >
              <path
                id="Path_6499"
                data-name="Path 6499"
                d="M212.555,170.708a1.718,1.718,0,0,0,.7.291v.263a.478.478,0,0,0,.956,0v-.328a1.341,1.341,0,0,0,.03-2.531,3.342,3.342,0,0,1-.708-.314c-.355-.262.1-.689.619-.287a.478.478,0,1,0,.648-.7,1.371,1.371,0,0,0-.589-.349v-.267a.478.478,0,0,0-.956,0v.283a1.2,1.2,0,0,0-.424,2.01,3.488,3.488,0,0,0,.924.467c.172.063.511.135.391.505a.459.459,0,0,1-.252.286.932.932,0,0,1-.813-.126.478.478,0,0,0-.523.8Z"
                transform="translate(-206.869 -161.067)"
              />
              <path
                id="Path_6500"
                data-name="Path 6500"
                d="M44.533,12.494l-1.425-1.018a6.34,6.34,0,0,0,1.159-3.671A6.409,6.409,0,0,0,37.92,1.4a27.374,27.374,0,0,0-2.8-.031V.458A.458.458,0,0,0,34.4.086L31.2,2.372a.457.457,0,0,0,0,.744L32.62,4.133a6.4,6.4,0,0,0,5.245,10.074v0a27.354,27.354,0,0,0,2.744.033v.915a.458.458,0,0,0,.723.372l3.2-2.286a.458.458,0,0,0,0-.744ZM34.206,1.346V1.83a.457.457,0,0,0,.457.457h2.754a2.091,2.091,0,0,1,2.244,1.842A3.205,3.205,0,0,0,37.407,3.2H34.663a.457.457,0,0,0-.457.457v.483l-1.957-1.4Zm-.842,3.318L34.4,5.4a.458.458,0,0,0,.723-.372V4.116h2.287A2.29,2.29,0,0,1,39.564,5.64a.457.457,0,0,0,.862,0,3.462,3.462,0,0,0-.273-2.823,5.488,5.488,0,0,1,2.21,8.126l-1.032-.737a.458.458,0,0,0-.723.372v.915H38.322A2.29,2.29,0,0,1,36.166,9.97a.457.457,0,0,0-.862,0,3.2,3.2,0,0,0,.373,2.868,5.493,5.493,0,0,1-2.312-8.172Zm8.159,9.6V13.78a.457.457,0,0,0-.457-.457H38.322a2.291,2.291,0,0,1-2.241-1.83,3.206,3.206,0,0,0,2.241.915h2.744a.457.457,0,0,0,.457-.457v-.483l1.957,1.4Z"
                transform="translate(-31.005 0)"
              />
            </svg>
          </button>
        </div>
      </mat-cell>
    </ng-container>

    <ng-container matColumnDef="depositForm">
      <mat-cell
        *matCellDef="let row; let i = dataIndex"
        [attr.colspan]="displayedColumns.length"
      >
        <div
          class="row-section deposit"
          [ngClass]="{ hidden: this.activePane !== i + '-deposit' }"
        >
          <mat-form-field appearance="outline" class="address-container">
            <mat-label>Deposit Address</mat-label>
            <input
              type="text"
              name="address"
              id="address"
              matInput
              [value]="walletAddress ? walletAddress.address : 'Fetching...'"
              class="address-input"
              readonly
              disabled
              #addressCode
            />
          </mat-form-field>
          <button
            mat-stroked-button
            type="button"
            class="copy-button"
            [cdkCopyToClipboard]="addressCode.value"
            (click)="handleClickOnCopyAddress()"
          >
            Copy
          </button>
          <ul class="tips">
            <li>
              • Please don’t deposit any other digital assets except
              {{ row.shortName }} to the above address. Otherwise, you may lose
              your assets permanently.
            </li>
            <li>
              • Depositing to the above address requires confirmations of the
              entire network. It will arrive after 12 confirmations, and it will
              be available to withdraw after 12 confirmations.
            </li>
            <li>
              • Your deposit address won’t change often. If there are any
              changes, we will notify you via announcement or email.
            </li>
            <li>
              • Please make sure that your computer and browser are secure and
              your information is protected from being tampered or leaked.
            </li>
          </ul>
        </div>
      </mat-cell>
    </ng-container>

    <ng-container matColumnDef="withdrawForm">
      <mat-cell
        *matCellDef="let row; let i = dataIndex"
        [attr.colspan]="displayedColumns.length"
      >
        <div
          class="row-section withdraw"
          [ngClass]="{ hidden: this.activePane !== i + '-withdraw' }"
        >
          <form
            autocomplete="off"
            (ngSubmit)="onSubmitWithdraw(i, form.value)"
            #form="ngForm"
          >
            <input
              type="hidden"
              name="currency"
              [ngModel]="row.shortName"
              [value]="row.shortName"
            />
            <mat-form-field appearance="outline" class="address-container">
              <mat-label>Address</mat-label>
              <input
                type="text"
                name="address"
                id="address"
                matInput
                class="address-input"
                [(ngModel)]="form.value.address"
                required
                #address="ngModel"
              />
            </mat-form-field>
            <mat-form-field appearance="outline">
              <mat-label>Amount</mat-label>
              <input
                type="number"
                name="amount"
                id="amount"
                matInput
                min="0"
                value="0"
                [(ngModel)]="form.value.amount"
                required
                #amount="ngModel"
              />
            </mat-form-field>
            <mat-form-field appearance="outline">
              <mat-label>Fee</mat-label>
              <input
                type="text"
                name="fee"
                id="fee"
                matInput
                [value]="row.payoutFee"
                readonly
                disabled
              />
            </mat-form-field>
            <mat-form-field appearance="outline">
              <mat-label>Received</mat-label>
              <input
                type="text"
                name="received"
                id="received"
                matInput
                [value]="
                  form.value.amount - row.payoutFee > 0
                    ? form.value.amount - row.payoutFee
                    : 'Quantity should be higher'
                "
                readonly
                disabled
              />
            </mat-form-field>
            <pro-button
              type="submit"
              color="primary"
              class="withdraw-button"
              [disabled]="
                !form.valid ||
                form.value.amount <= 0 ||
                form.value.amount <= row.payoutFee
              "
              #withdrawButton
            >
              Withdraw
            </pro-button>
            <div *ngIf="!!allErrors" arrangeStack style="width: 100%;">
              <mat-error *ngFor="let error of allErrors">{{ error }}</mat-error>
            </div>
          </form>
          <ul class="tips">
            <li>
              • Please make sure that your computer and browser are secure and
              your information is protected from being tampered or leaked.
            </li>
          </ul>
        </div>
      </mat-cell>
    </ng-container>

    <ng-container matColumnDef="transferForm">
      <mat-cell
        *matCellDef="let row; let i = dataIndex"
        [attr.colspan]="displayedColumns.length"
        ><div
          class="row-section transfer"
          [ngClass]="{ hidden: this.activePane !== i + '-transfer' }"
        >
          <form
            autocomplete="off"
            (ngSubmit)="onSubmitTransfer(i, form.value)"
            #form="ngForm"
          >
            <mat-radio-group
              arrangeStack
              arrangeCenter
              name="type"
              ngModel
              #type="ngModel"
              required
            >
              <mat-radio-button [value]="3" checked
                >Main Account to Trading</mat-radio-button
              >
              <mat-radio-button [value]="4"
                >Trading Account to Main</mat-radio-button
              >
            </mat-radio-group>
            <input
              type="hidden"
              name="currency"
              [ngModel]="row.shortName"
              required
              [value]="row.shortName"
            />
            <mat-form-field appearance="outline">
              <mat-label>Amount</mat-label>
              <input
                type="number"
                name="amount"
                id="amount"
                matInput
                value="0"
                min="0"
                ngModel
                required
                #amount="ngModel"
              />
            </mat-form-field>
            <pro-button
              color="primary"
              type="submit"
              [disabled]="!form.valid || form.value.amount <= 0"
              #transferButton
            >
              Transfer
            </pro-button>
            <div arrangeStack *ngIf="!!allErrors" style="width: 100%;">
              <mat-error *ngFor="let error of allErrors">{{ error }}</mat-error>
            </div>
          </form>
          <ul class="tips">
            <li>
              • Please make sure that your computer and browser are secure and
              your information is protected from being tampered or leaked.
            </li>
          </ul>
        </div></mat-cell
      >
    </ng-container>

    <mat-header-row *matHeaderRowDef="displayedColumns"></mat-header-row>
    <mat-row
      *matRowDef="let row; columns: displayedColumns; let i = dataIndex"
      [ngClass]="{ even: i % 2 === 0 }"
    ></mat-row>
    <mat-row
      *matRowDef="let row; columns: ['depositForm']; let i = dataIndex"
      class="expandable-row no-border"
      [ngClass]="{ even: i % 2 === 0 }"
      [@detailExpand]="activePane === i + '-deposit' ? 'expanded' : 'collapsed'"
    ></mat-row>

    <mat-row
      *matRowDef="let row; columns: ['withdrawForm']; let i = dataIndex"
      class="expandable-row no-border"
      [ngClass]="{ even: i % 2 === 0 }"
      [@detailExpand]="
        activePane === i + '-withdraw' ? 'expanded' : 'collapsed'
      "
    ></mat-row>

    <mat-row
      *matRowDef="let row; columns: ['transferForm']; let i = dataIndex"
      class="expandable-row no-border"
      [ngClass]="{ even: i % 2 === 0 }"
      [@detailExpand]="
        activePane === i + '-transfer' ? 'expanded' : 'collapsed'
      "
    ></mat-row>
  </mat-table>
</section>
